"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2626],{72372:function(e,l,s){var i=s(18992);let r="/api/v1";l.Z={findOrder:async(e,l)=>{var s,a,d,t,n;try{let a=await i.Z.get("".concat(r,"/getByIdForPrint"),{params:{id:e,table:l}});return{success:!0,data:null==a?void 0:null===(s=a.data)||void 0===s?void 0:s.data}}catch(e){return{success:!1,e:(null==e?void 0:null===(d=e.response)||void 0===d?void 0:null===(a=d.data)||void 0===a?void 0:a.error)||(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)}}},findGeneralDriver:async(e,l)=>{var s,a,d,t,n;try{let a=await i.Z.get("".concat(r,"/getPrintReportGeneralDriver"),{params:{id:e,table:l}});return{success:!0,data:null==a?void 0:null===(s=a.data)||void 0===s?void 0:s.data}}catch(e){return{success:!1,e:(null==e?void 0:null===(d=e.response)||void 0===d?void 0:null===(a=d.data)||void 0===a?void 0:a.error)||(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)}}},findDelivery:async(e,l)=>{var s,a,d,t,n;try{let a=await i.Z.get("".concat(r,"/getByIdForPrintDelivery"),{params:{id:e,action:l}});return{success:!0,data:null==a?void 0:null===(s=a.data)||void 0===s?void 0:s.data}}catch(e){return{success:!1,e:(null==e?void 0:null===(d=e.response)||void 0===d?void 0:null===(a=d.data)||void 0===a?void 0:a.error)||(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)}}},findReportDriver:async(e,l,s)=>{var a,d,t,n,o;try{let d=await i.Z.get("".concat(r,"/getReportDriverExcel"),{params:{reported:e,id:l,action:s}});return{success:!0,data:null==d?void 0:null===(a=d.data)||void 0===a?void 0:a.data}}catch(e){return{success:!1,e:(null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(d=t.data)||void 0===d?void 0:d.error)||(null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.message)}}},findReportCustomerExcel:async(e,l,s)=>{var a,d,t,n,o;try{let d=await i.Z.get("".concat(r,"/getReportCustomerExcel"),{params:{reported:e,id:l,action:s}});return{success:!0,data:null==d?void 0:null===(a=d.data)||void 0===a?void 0:a.data}}catch(e){return{success:!1,e:(null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(d=t.data)||void 0===d?void 0:d.error)||(null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.message)}}},getReportWareSelect:async e=>{var l,s,a,d,t;try{let s=await i.Z.get("".concat(r,"/getReportWareSelect"),{params:{id:e}});return{success:!0,data:null==s?void 0:null===(l=s.data)||void 0===l?void 0:l.data}}catch(e){return{success:!1,e:(null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.error)||(null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(d=t.data)||void 0===d?void 0:d.message)}}}}},12626:function(e,l,s){s.r(l),s.d(l,{default:function(){return Report}});var i=s(85893),r=s(86414),a=s(47181),d=s(102),t=s(36616),n=s(23583),o=s(95085),c=s(90303),u=s(96034),v=s(95601),m=s(15779),h=s(95124),x=s(67294),j=s(79153),g=s(85158),p=s(11163),f=s(60946),b=s(53907),y=s(88767),N=s(27484),w=s.n(N),C=s(26148),k=s(36199),T=s(54073),_=s(72372),D=s(43681),A=s(42099),S=s(92256),Report_detailModal=e=>{var l,s,r,a,d,t;let{opened:n,onClose:c,id:u}=e,[v,m]=(0,x.useState)("delivery"),{data:h,isLoading:j}=(0,y.useQuery)(["report-details",u],()=>k.Z.getCustomerReportDetail(u),{enabled:n&&!!u,cacheTime:3e5,staleTime:6e4,refetchOnWindowFocus:!1}),{data:g,isLoading:p}=(0,y.useQuery)(["report-details","item",u],()=>k.Z.getGroupItem(u),{enabled:n&&!!u,cacheTime:3e5,staleTime:6e4,refetchOnWindowFocus:!1});return(0,i.jsxs)(A.u,{opened:n,onClose:c,title:(0,i.jsx)("p",{className:"font-bold text-indigo-600",children:"Тайлан дэлгэрэнгүй"}),size:"70%",radius:16,children:[(0,i.jsxs)("div",{className:"h-10 sm:text-sm text-xs text-center w-full font-semibold text-indigo-600 mb-6 bg-gray-100 rounded-xl flex justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center justify-center w-1/2 h-full cursor-pointer ".concat("delivery"===v?"text-white font-bold bg-indigo-600 rounded-xl":""),onClick:()=>{m("delivery")},children:["Хүргэлтийн мэдээллээр (",Math.floor((null==h?void 0:null===(s=h.data)||void 0===s?void 0:null===(l=s.result)||void 0===l?void 0:l.length)||0),")"]}),(0,i.jsxs)("div",{className:"flex items-center justify-center w-1/2 h-full cursor-pointer ".concat("item"===v?"text-white font-bold bg-indigo-600 rounded-xl":""),onClick:()=>{m("item")},children:["Барааны мэдээллээр (",Math.floor((null==g?void 0:null===(r=g.data)||void 0===r?void 0:r.length)||0),")"]})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-4 relative max-h-[600px] overflow-scroll",children:[(0,i.jsx)(o.f,{visible:j||p,zIndex:1e3}),"delivery"===v?(null==h?void 0:null===(d=h.data)||void 0===d?void 0:null===(a=d.result)||void 0===a?void 0:a.length)>0?null==h?void 0:h.data.result.map(e=>{var l,s;return(0,i.jsxs)("div",{className:"border rounded-lg p-4 flex flex-col gap-3",children:[(0,i.jsxs)("div",{className:"sm:flex block justify-between items-center",children:[(0,i.jsx)("div",{className:"text-md font-bold",children:e.code}),(0,i.jsxs)("div",{children:[10==e.status&&(0,i.jsx)(S.C,{color:"green",children:"Хүргэгдсэн"}),11==e.status&&(0,i.jsx)(S.C,{color:"#F5627E",children:"Цуцалсан"}),12==e.status&&(0,i.jsx)(S.C,{color:"#FB4242",children:"Буцаасан"})]})]}),(0,i.jsxs)("div",{className:"sm:flex block justify-between items-start gap-4",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("p",{className:"font-semibold",children:"Хэрэглэгчийн мэдээлэл:"}),(0,i.jsxs)("span",{children:[e.cus_name||""," ",e.cus_phone||""]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("p",{className:"font-semibold",children:"Үүсгэсэн огноо:"}),(0,i.jsx)("span",{children:w()(e.created_at).format("YYYY/MM/DD HH:mm")})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("p",{className:"font-semibold",children:"Жолооч:"}),(0,i.jsx)("span",{children:e.driver_name||""})]}),e.driver_desc&&(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("p",{className:"font-semibold",children:"Жолоочийн тайлбар:"}),(0,i.jsx)("span",{children:e.driver_desc})]})]}),(0,i.jsx)("ul",{className:"list-disc pl-4 space-y-1 mt-2 sm:mt-0",children:null==h?void 0:null===(s=h.data)||void 0===s?void 0:null===(l=s.resultItem)||void 0===l?void 0:l.filter(l=>l.delivery_id==e.code).map(e=>(0,i.jsxs)("li",{children:["Бараа: ",e.name," | Тоо: ",e.quantity,"ш"]},e.id))})]})]},e.code)}):(0,i.jsx)("p",{className:"text-center text-lg",children:"Мэдээлэл олдсонгүй"}):null,"item"===v?(null==g?void 0:null===(t=g.data)||void 0===t?void 0:t.length)>0?null==g?void 0:g.data.map(e=>(0,i.jsxs)("div",{className:"border rounded-lg p-4 flex justify-between items-center",children:[(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("p",{className:"font-semibold",children:"Барааны нэр:"}),(0,i.jsx)("span",{children:e.name||""})]}),(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsxs)(S.C,{variant:"dot",color:"green",children:["Хүргэгдсэн: ",e.deliveried,"ш"]}),(0,i.jsxs)(S.C,{variant:"dot",color:"#F5627E",children:["Цуцалсан: ",e.canceled,"ш"]}),(0,i.jsxs)(S.C,{variant:"dot",color:"#FB4242",children:["Буцаасан: ",e.returned,"ш"]})]})]},e.id)):(0,i.jsx)("p",{className:"text-center text-lg",children:"Мэдээлэл олдсонгүй"}):null]})]})},Report=()=>{var e,l,s;let[N,A]=(0,x.useState)([]),[S,F]=(0,x.useState)(""),Y=(0,p.useRouter)(),[M,Z]=(0,x.useState)(100),[R,E]=(0,x.useState)(0),[P,z]=(0,x.useState)(0),[H,W]=(0,x.useState)(""),[B,G]=(0,x.useState)("asc"),[I,Q]=(0,x.useState)(""),[O]=(0,b.c)(I,200),[q,U]=(0,x.useState)(null),[V,X]=(0,x.useState)(null),[L,J]=(0,x.useState)(!1),[K,$]=(0,x.useState)(!1),{user:ee}=(0,D.a)(),[el,es]=(0,x.useState)(""),[ei,er]=(0,x.useState)(!1),[ea,ed]=(0,x.useState)(null),{data:et,isLoading:en,isFetching:eo,refetch:ec}=(0,y.useQuery)(["order-list-report",M,R,H,B,O,S,q,V],()=>(null==ee?void 0:ee.role)!=="customer"?k.Z.generalCustomer(P,M,H,B,O,S,q,V):k.Z.getReportGeneralCustomerByUser(P,M,H,B,O,S,q,V,null==ee?void 0:ee.user_id)),{data:eu}=(0,y.useQuery)(["user-list"],()=>C.Z.find(),{enabled:el.length>2,staleTime:6e5,cacheTime:12e5}),{data:ev}=(0,y.useQuery)(["selected-data-report",N],()=>(null==N?void 0:N.length)>0?_.Z.findGeneralDriver(N,"report_cus"):Promise.reject()),handleCheckboxChange=e=>{A(l=>"selectAll"===e?l.length<(null==et?void 0:et.data.length)?null==et?void 0:et.data.map(e=>e.id):[]:l.includes(e)?l.filter(l=>l!==e):[...l,e])},em=(0,y.useMutation)(["edit-dans"],e=>k.Z.editPay(e,K),{onSuccess(e){(null==e?void 0:e.success)===!0?(ec(),(0,f.PV)({message:"",status:!0})):(0,f.PV)({message:null==e?void 0:e.e,status:!1})}}),handleChange=async e=>{(null==ee?void 0:ee.role)!=="customer"&&await em.mutateAsync(e)};return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"bg-white rounded-xl p-3",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)(f.bo,{text:"Харилцагчийн ерөнхий тайлан"}),(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsx)(r.o,{className:"sm:w-96 w-40",placeholder:"Хайх ...",value:I,onChange:e=>{Q(e.target.value)},rightSection:(0,i.jsx)(j.Z,{color:"#6A5ADF",className:"cursor-pointer"})}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(a.z,{color:"#6A5ADF",radius:9,leftSection:(0,i.jsx)("img",{src:"/icons/excel.svg",alt:"excel"}),onClick:()=>J(e=>!e),children:"Excel"}),(0,i.jsx)(d.U,{in:L,className:"absolute right-0 rounded-lg border border-indigo-300 space-y-2 p-3 w-44 h-auto bg-white z-40 font-bold text-sm text-indigo-600",children:(0,i.jsxs)("button",{disabled:en||eo,className:"flex items-center space-x-2 pb-2 border-b cursor-pointer",onClick:()=>{var e;return(0,f.pq)("report-general-excel",null===(e=(null==N?void 0:N.length)>0?null==ev?void 0:ev.data:null==et?void 0:et.data)||void 0===e?void 0:e.map(e=>({Огноо:w()(e.created_at||"").format("YYYY-MM-DD HH:mm"),Дэлгүүрийн_нэр:e.shop_name,Хүргэлтийн_тоо:e.count,Авсан_мөнгө:null==e?void 0:e.sum,Нийт_хүргэлтийн_үнэ:null==e?void 0:e.payment,Зөрүү:null==e?void 0:e.zoruu,Ажилчин:e.worker})))},children:[(0,i.jsx)("img",{src:"/icons/excel-color.svg",alt:"icon"}),(0,i.jsx)("p",{children:"Export to Excel"})]})})]})]})]}),(0,i.jsx)("div",{className:"border-b border-[#6A5ADF] w-full mt-2 mb-1"}),(0,i.jsxs)("div",{className:"relative sm:flex items-center mr-12 gap-4",children:[(0,i.jsx)("div",{className:"text-sm",children:(0,i.jsx)(T.W,{label:"Эхлэх огноо",placeholder:"yyyy-mm-dd",valueFormat:"YYYY-MM-DD",value:q,onChange:U,clearable:!0})}),(0,i.jsx)("div",{className:"text-sm",children:(0,i.jsx)(T.W,{label:"Дуусах огноо",placeholder:"yyyy-mm-dd",valueFormat:"YYYY-MM-DD",value:V,onChange:X,clearable:!0})}),(null==ee?void 0:ee.role)!=="customer"&&(0,i.jsx)(t.P,{label:"Харилцагч",searchable:!0,data:((null==eu?void 0:eu.data)||[]).filter(e=>(null==e?void 0:e.role)==="customer"&&(null==e?void 0:e.active)==1).map(e=>({value:null==e?void 0:e.shop_name.toString(),label:(null==e?void 0:e.shop_name)||""})),onSearchChange:e=>{es(e)},onChange:e=>{W("shop_name"),F(e),G("")},clearable:!0,placeholder:"Бүгд"}),(0,i.jsx)(n.u,{label:"Шүүлтүүр цэвэрлэх",children:(0,i.jsx)("div",{className:"mt-6 cursor-pointer p-1 rounded-sm border",onClick:()=>{W(""),G(""),F(""),U(null),X(null),Y.reload()},children:(0,i.jsx)("img",{src:"/icons/filter-clear.svg",alt:"filterClear"})})})]}),(0,i.jsx)("div",{className:"border-1 border-b border-[#6A5ADF] mt-2"}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(o.f,{visible:en||eo}),(0,i.jsx)(c.x,{className:"h-[70vh]",color:"#6A5ADF",children:(0,i.jsxs)(u.i,{children:[(0,i.jsx)(u.i.Thead,{className:"sticky top-0 bg-white z-40",children:(0,i.jsxs)(u.i.Tr,{children:[(0,i.jsx)(u.i.Th,{className:"sticky left-0 bg-white",children:(0,i.jsx)(v.X,{checked:N.length===(null==et?void 0:null===(e=et.data)||void 0===e?void 0:e.length),onChange:()=>handleCheckboxChange("selectAll"),color:"#6A5ADF"})}),(0,i.jsx)(u.i.Th,{children:"#"}),(0,i.jsx)(u.i.Th,{miw:150,children:(0,i.jsxs)("div",{className:"flex justify-between",children:["Огноо",(0,i.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{W("created_at"),"desc"===B?G("asc"):G("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,i.jsx)(u.i.Th,{miw:200,children:(0,i.jsxs)("div",{className:"flex justify-between",children:["Дэлгүүрийн нэр",(0,i.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{W("driver_name"),"desc"===B?G("asc"):G("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,i.jsx)(u.i.Th,{miw:160,children:(0,i.jsxs)("div",{className:"flex justify-between",children:["Хүргэлтийн тоо",(0,i.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{W("count"),"desc"===B?G("asc"):G("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,i.jsx)(u.i.Th,{miw:160,children:(0,i.jsxs)("div",{className:"flex justify-between",children:["Нийт авсан дүн",(0,i.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{W("total_price"),"desc"===B?G("asc"):G("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,i.jsx)(u.i.Th,{miw:200,children:(0,i.jsxs)("div",{className:"flex justify-between",children:["Нийт хүргэлтийн үнэ",(0,i.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{W("total_price"),"desc"===B?G("asc"):G("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,i.jsx)(u.i.Th,{miw:120,children:(0,i.jsxs)("div",{className:"flex justify-between",children:["Зөрүү",(0,i.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{W("total_price"),"desc"===B?G("asc"):G("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,i.jsx)(u.i.Th,{miw:100,children:(0,i.jsxs)("div",{className:"flex justify-between",children:["Ажилчин",(0,i.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{W("worker"),"desc"===B?G("asc"):G("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,i.jsx)(u.i.Th,{miw:150,children:(0,i.jsxs)("div",{className:"flex justify-between",children:["Данс",(0,i.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{W("worker"),"desc"===B?G("asc"):G("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,i.jsx)(u.i.Th,{miw:100,children:(0,i.jsxs)("div",{className:"flex justify-between",children:["Төлбөр",(0,i.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{W("pay"),"desc"===B?G("asc"):G("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,i.jsx)(u.i.Th,{className:"sticky right-0 bg-white",children:"Үйлдэл"})]})}),(0,i.jsx)(u.i.Tbody,{children:(null==et?void 0:null===(l=et.data)||void 0===l?void 0:l.length)>0?null==et?void 0:null===(s=et.data)||void 0===s?void 0:s.map((e,l)=>(0,i.jsxs)(u.i.Tr,{children:[(0,i.jsx)(u.i.Td,{className:"sticky left-0 bg-white",children:(0,i.jsx)(v.X,{color:"#6A5ADF",checked:N.includes(null==e?void 0:e.id),onChange:()=>handleCheckboxChange(null==e?void 0:e.id)})}),(0,i.jsx)(u.i.Td,{children:l+1}),(0,i.jsx)(u.i.Td,{maw:200,children:w()(null==e?void 0:e.created_at).format("YYYY/MM/DD HH:mm")}),(0,i.jsx)(u.i.Td,{maw:200,children:null==e?void 0:e.shop_name}),(0,i.jsx)(u.i.Td,{maw:200,children:(0,f.uf)(null==e?void 0:e.count)}),(0,i.jsx)(u.i.Td,{maw:200,children:(0,f.uf)(null==e?void 0:e.sum)}),(0,i.jsx)(u.i.Td,{children:(0,f.uf)(null==e?void 0:e.payment)}),(0,i.jsx)(u.i.Td,{children:(0,f.uf)(null==e?void 0:e.zoruu)}),(0,i.jsx)(u.i.Td,{children:null==e?void 0:e.worker}),(0,i.jsxs)(u.i.Td,{children:[(null==e?void 0:e.bank_num)||"",(0,i.jsx)("br",{}),(null==e?void 0:e.bank_type)||""]}),(0,i.jsx)(u.i.Td,{children:(null==e?void 0:e.pay)==0?(0,i.jsx)("p",{className:"text-red-500 font-semibold cursor-pointer",onClick:()=>{handleChange(null==e?void 0:e.id),$(!0)},children:"Шилжээгүй"}):(0,i.jsx)("p",{className:"text-green-500 font-semibold cursor-pointer",onClick:()=>{handleChange(null==e?void 0:e.id),$(!1)},children:"Шилжсэн"})}),(0,i.jsx)(u.i.Td,{className:"flex justify-center sticky right-0 bg-white gap-1",children:(0,i.jsx)(m.A,{color:"yellow",onClick:()=>{er(!0),ed(null==e?void 0:e.id)},children:(0,i.jsx)(n.u,{label:"Дэлгэрэнгүй харах",children:(0,i.jsx)(g.Z,{})})})})]},"reportData-".concat(l))):(0,i.jsx)(u.i.Tr,{children:(0,i.jsx)(u.i.Td,{colSpan:12,className:"text-center",children:"Мэдээлэл олдсонгүй"})})})]})}),ei&&(0,i.jsx)(Report_detailModal,{opened:ei,id:ea,onClose:()=>er(!1)}),(0,i.jsx)("div",{className:"border-b border-[#6A5ADF] w-full my-1"}),(0,i.jsxs)("div",{className:"flex justify-between items-center my-1",children:[(0,i.jsxs)("p",{className:"text-sm text-[#6A5ADF]",children:["Нийт ",null==N?void 0:N.length," мөр сонгосон байна"]}),(0,i.jsxs)("p",{className:"flex items-center text-sm text-[#6A5ADF]",children:["Нэг хуудсанд харуулах мөрийн тоо",(0,i.jsxs)("select",{className:"w-12 rounded-md ml-2 pl-0.5 h-6 border border-[#6A5ADF]",onChange:e=>{Z(e.target.value),E(0),z(0)},children:[(0,i.jsx)("option",{value:"100",children:"100"}),(0,i.jsx)("option",{value:"250",children:"250"}),(0,i.jsx)("option",{value:"500",children:"500"}),(0,i.jsx)("option",{value:"1000",children:"1000"})]})]})]}),(0,i.jsx)("div",{className:"flex my-4 items-center justify-end",children:(0,i.jsx)(h.t,{value:R+1,siblings:2,total:Math.floor((null==et?void 0:et.pagination)/M)+((null==et?void 0:et.pagination)%M==0?0:1),onChange:e=>{E(e-1),z(e*M-M)},color:"#6A5ADF"})})]})]})})}}}]);