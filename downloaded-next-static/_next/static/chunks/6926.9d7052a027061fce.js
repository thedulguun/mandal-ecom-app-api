"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6926],{6926:function(e,l,s){s.r(l);var a=s(85893),i=s(86414),r=s(47181),d=s(102),n=s(36616),o=s(23583),t=s(95085),c=s(90303),u=s(96034),h=s(95601),v=s(92256),m=s(15779),x=s(95124),j=s(54073),b=s(67294),g=s(79153),p=s(85158),f=s(11163),y=s(60946),N=s(53907),w=s(98298),C=s(88767),_=s(27484),T=s.n(_),A=s(26148),k=s(60894),D=s(87412),S=s(12499),Y=s(43681),F=s(72372);l.default=()=>{var e,l,s,_,M;let{user:Z}=(0,Y.a)(),[P,H]=(0,b.useState)([]),[Q,E]=(0,b.useState)(!1),[q,z]=(0,b.useState)(""),[O,W]=(0,b.useState)(!1),X=(0,f.useRouter)(),[L,R]=(0,b.useState)(100),[U,B]=(0,b.useState)(0),[G,I]=(0,b.useState)(0),[J,K]=(0,b.useState)(""),[V,$]=(0,b.useState)("asc"),[ee,el]=(0,b.useState)(""),[es]=(0,N.c)(ee,200),[ea,ei]=(0,b.useState)(null),[er,ed]=(0,b.useState)(null),{data:en,refetch:eo,isLoading:et}=(0,C.useQuery)(["order-list",L,U,J,V,es,q,ea,er,Z],()=>(null==Z?void 0:Z.role)==="admin"||(null==Z?void 0:Z.role)==="manager"||(null==Z?void 0:Z.role)==="nyagtlan"||(null==Z?void 0:Z.role)=="operator"?w.Z.find(G,L,J,V,es,q,ea,er,5):Promise.reject()),{data:ec,isLoading:eu,refetch:eh}=(0,C.useQuery)(["customer-by-id",L,U,J,V,es,q,ea,er,Z],()=>(null==Z?void 0:Z.role)=="customer"?w.Z.getOrderCustomer(G,L,J,V,es,q,ea,er,5,null==Z?void 0:Z.user_id):Promise.reject()),{data:ev}=(0,C.useQuery)(["region-list"],()=>k.Z.find(),{enabled:(null==Z?void 0:Z.role)!="customer"}),{data:em}=(0,C.useQuery)(["selected-data",P],()=>(null==P?void 0:P.length)>0?F.Z.findOrder(P,"orders"):Promise.reject()),{data:ex}=(0,C.useQuery)(["user-list"],()=>A.Z.find(),{enabled:(null==Z?void 0:Z.role)!="customer"}),{data:ej}=(0,C.useQuery)(["driver-list"],()=>A.Z.getDriver(),{enabled:(null==Z?void 0:Z.role)!="customer"}),handleCheckboxChange=e=>{H(l=>{if("selectAll"===e){var s;return l.length<((null==en?void 0:en.data.length)||(null==ec?void 0:null===(s=ec.data)||void 0===s?void 0:s.length))?((null==en?void 0:en.data)||(null==ec?void 0:ec.data)).map(e=>e.id):[]}return l.includes(e)?l.filter(l=>l!==e):[...l,e]})};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"bg-white rounded-xl p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(y.bo,{text:"Тайлан захиалгаар"}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)(i.o,{className:"w-96",placeholder:"Хайх ...",value:ee,onChange:e=>{el(e.target.value)},rightSection:(0,a.jsx)(g.Z,{color:"#6A5ADF",className:"cursor-pointer"})}),(0,a.jsx)(S.Z,{data:(null==P?void 0:P.length)>0?P:(null==en?void 0:en.data)||(null==ec?void 0:ec.data),select:(null==P?void 0:P.length)>0,table:"orders"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(r.z,{color:"#6A5ADF",radius:9,leftSection:(0,a.jsx)("img",{src:"/icons/excel.svg",alt:"excel"}),onClick:()=>W(e=>!e),children:"Excel"}),(0,a.jsx)(d.U,{in:O,className:"absolute right-0 rounded-lg border border-indigo-300 space-y-2 p-3 w-44 h-auto bg-white z-40 font-bold text-sm text-indigo-600",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2 pb-2 border-b cursor-pointer",onClick:()=>(0,y.pq)("order-excel",((null==P?void 0:P.length)>0?null==em?void 0:em.data:(null==en?void 0:en.data)||(null==ec?void 0:ec.data)).map(e=>({Дэлгүүрийн_нэр:e.shop_name,Салбар:e.name,Утас:e.branch_phone||"",Хаяг:"".concat(e.city," ").concat(e.district," ").concat(e.committee," ").concat(e.street," ").concat(e.toot," ").concat(e.branch_address," ").concat(e.branch_addition),Үүсгэсэн_огноо:T()(e.created_at).format("YYYY-MM-DD HH:mm"),Төлөв:1==e.status?"Бүртгэгдсэн":2==e.status?"Жолоочид хуваарилсан":3==e.status?"Жолооч хүлээн авсан":4==e.status?"Дууссан":null,Тоо:e.quantity||"",Жолооч_хүлээн_авсан:(null==e?void 0:e.received_driver)&&T()(e.received_driver||"").format("YYYY-MM-DD HH:mm")||"",Жолооч:e.driver_name||""}))),children:[(0,a.jsx)("img",{src:"/icons/excel-color.svg",alt:"icon"}),(0,a.jsx)("p",{children:"Export to Excel"})]})})]}),(null==Z?void 0:Z.role)!=="nyagtlan"&&(0,a.jsx)(r.z,{color:"#6A5ADF",radius:9,leftSection:(0,a.jsx)("img",{src:"/icons/plus.svg",alt:"plus"}),onClick:()=>X.push("/order/create"),children:"Шинэ захиалга бүртгэх"})]})]}),(0,a.jsx)("div",{className:"border-b border-[#6A5ADF] w-full mt-2 mb-1"}),(0,a.jsxs)("div",{className:"relative flex items-center mr-12 gap-4",children:[(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsx)(j.W,{label:"Эхлэх огноо",placeholder:"yyyy-mm-dd",valueFormat:"YYYY-MM-DD",value:ea,onChange:ei,clearable:!0})}),(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsx)(j.W,{label:"Дуусах огноо",placeholder:"yyyy-mm-dd",valueFormat:"YYYY-MM-DD",value:er,onChange:ed,clearable:!0})}),(0,a.jsx)(n.P,{label:"Төлөв",searchable:!0,clearable:!0,data:[{label:"Бүгд",value:""},{label:"Бүртгэгдсэн",value:"1"},{label:"Жолоочид хуваарилсан",value:"2"},{label:"Жолооч хүлээн авсан",value:"3"},{label:"Дууссан",value:"4"}].map(e=>({value:null==e?void 0:e.value.toString(),label:(null==e?void 0:e.label)||""})),onChange:e=>{K("orders.status"),z(e),$("")},placeholder:"Бүгд"}),(null==Z?void 0:Z.role)!="customer"&&(0,a.jsx)(n.P,{label:"Бүс",data:((null==ev?void 0:ev.data)||[]).map(e=>({value:null==e?void 0:e.name.toString(),label:(null==e?void 0:e.name)||""})),searchable:!0,clearable:!0,onChange:e=>{K("branch.region"),z(e),$("")},placeholder:"Бүгд"}),(null==Z?void 0:Z.role)!="customer"&&(0,a.jsx)(n.P,{label:"Жолооч",searchable:!0,clearable:!0,data:((null==ej?void 0:ej.data)||[]).filter(e=>(null==e?void 0:e.role)!=="driver2").map(e=>({value:null==e?void 0:e.driver_name.toString(),label:(null==e?void 0:e.driver_name)||""})),onChange:e=>{K("orders.driver_name"),z(e),$("")},placeholder:"Бүгд"}),(null==Z?void 0:Z.role)==="admin"&&(0,a.jsx)(n.P,{label:"Харилцагч",searchable:!0,data:((null==ex?void 0:ex.data)||[]).filter(e=>(null==e?void 0:e.role)==="customer").map(e=>({value:null==e?void 0:e.shop_name.toString(),label:(null==e?void 0:e.shop_name)||""})),onChange:e=>{K("users.shop_name"),z(e),$("")},clearable:!0,placeholder:"Бүгд"}),(0,a.jsx)(o.u,{label:"Шүүлтүүр цэвэрлэх",children:(0,a.jsx)("div",{className:"cursor-pointer p-1 rounded-sm border mt-6",onClick:()=>{K(""),$(""),z(""),X.reload()},children:(0,a.jsx)("img",{src:"/icons/filter-clear.svg",alt:"filterClear"})})})]}),(0,a.jsx)("div",{className:"border-1 border-b border-[#6A5ADF] mt-2"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(t.f,{visible:(null==Z?void 0:Z.role)==="customer"?eu:et}),(0,a.jsx)(c.x,{className:"h-[70vh]",color:"#6A5ADF",children:(0,a.jsxs)(u.i,{children:[(0,a.jsx)(u.i.Thead,{className:"sticky top-0 bg-white z-40",children:(0,a.jsxs)(u.i.Tr,{children:[(0,a.jsx)(u.i.Th,{className:"sticky left-0 bg-white",children:(0,a.jsx)(h.X,{checked:P.length===((null==en?void 0:null===(e=en.data)||void 0===e?void 0:e.length)||(null==ec?void 0:null===(l=ec.data)||void 0===l?void 0:l.length)),onChange:()=>handleCheckboxChange("selectAll"),color:"#6A5ADF"})}),(0,a.jsx)(u.i.Th,{children:"#"}),(0,a.jsx)(u.i.Th,{miw:150,children:(0,a.jsxs)("div",{className:"flex justify-between",children:["Огноо",(0,a.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{K("orders.created_at"),"desc"===V?$("asc"):$("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,a.jsx)(u.i.Th,{miw:140,children:(0,a.jsxs)("div",{className:"flex justify-between",children:["Харилцагч",(0,a.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{K("users.shop_name"),"desc"===V?$("asc"):$("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,a.jsx)(u.i.Th,{miw:130,children:(0,a.jsxs)("div",{className:"flex justify-between",children:["Салбар",(0,a.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{K("branch.name"),"desc"===V?$("asc"):$("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,a.jsx)(u.i.Th,{miw:300,children:"Хаяг"}),(0,a.jsx)(u.i.Th,{miw:100,children:(0,a.jsxs)("div",{className:"flex justify-between",children:["Жолооч",(0,a.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{K("orders.driver_name"),"desc"===V?$("asc"):$("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,a.jsx)(u.i.Th,{miw:100,children:(0,a.jsxs)("div",{className:"flex justify-between",children:["Утас",(0,a.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{K("branch.branch_phone"),"desc"===V?$("asc"):$("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(0,a.jsx)(u.i.Th,{miw:200,children:"Нэмэлт тайлбар"}),(0,a.jsx)(u.i.Th,{miw:200,children:"Жолоочийн тайлбар"}),(0,a.jsx)(u.i.Th,{miw:90,children:"Төлөв"}),(0,a.jsx)(u.i.Th,{miw:100,children:"Бүс"}),(0,a.jsx)(u.i.Th,{miw:90,children:(0,a.jsxs)("div",{className:"flex justify-between",children:["Тоо",(0,a.jsx)("img",{src:"/icons/sort.svg",alt:"sort",onClick:()=>{K("orders.quantity"),"desc"===V?$("asc"):$("desc")},className:"cursor-pointer hover:bg-gray-100 hover:rounded-md"})]})}),(null==Z?void 0:Z.role)==="admin"&&(0,a.jsx)(u.i.Th,{className:"sticky right-0 bg-white",children:"Үйлдэл"})]})}),(0,a.jsx)(u.i.Tbody,{children:(null==en?void 0:null===(s=en.data)||void 0===s?void 0:s.length)>0||(null==ec?void 0:null===(_=ec.data)||void 0===_?void 0:_.length)>0?null===(M=(null==en?void 0:en.data)||(null==ec?void 0:ec.data))||void 0===M?void 0:M.map((e,l)=>(0,a.jsxs)(u.i.Tr,{children:[(0,a.jsx)(u.i.Td,{className:"sticky left-0 bg-white",children:(0,a.jsx)(h.X,{color:"#6A5ADF",checked:P.includes(null==e?void 0:e.id),onChange:()=>handleCheckboxChange(null==e?void 0:e.id)})}),(0,a.jsx)(u.i.Td,{children:l+1}),(0,a.jsx)(u.i.Td,{children:T()(null==e?void 0:e.created_at).format("YYYY/MM/DD HH:mm")}),(0,a.jsx)(u.i.Td,{maw:200,children:null==e?void 0:e.shop_name}),(0,a.jsx)(u.i.Td,{maw:200,children:null==e?void 0:e.name}),(0,a.jsx)(u.i.Td,{maw:200,className:"",children:"".concat((null==e?void 0:e.city)||""," ").concat((null==e?void 0:e.district)||""," ").concat((null==e?void 0:e.committee)||""," ").concat((null==e?void 0:e.street)||""," ").concat((null==e?void 0:e.toot)||""," ").concat((null==e?void 0:e.branch_address)||""," ").concat((null==e?void 0:e.branch_addition)||"")}),(0,a.jsx)(u.i.Td,{maw:200,children:null==e?void 0:e.driver_name}),(0,a.jsx)(u.i.Td,{maw:200,children:null==e?void 0:e.branch_phone}),(0,a.jsx)(u.i.Td,{className:"",maw:200,children:null==e?void 0:e.order_desc}),(0,a.jsx)(u.i.Td,{maw:200,mah:20,children:null==e?void 0:e.driver_desc}),(0,a.jsx)(u.i.Td,{children:(null==e?void 0:e.status)==1?(0,a.jsx)(v.C,{color:"#6A5ADF",children:"Бүртгэгдсэн"}):(null==e?void 0:e.status)==2?(0,a.jsx)(v.C,{color:"yellow",children:"Жолоочид хуваарилсан"}):(null==e?void 0:e.status)==3?(0,a.jsx)(v.C,{color:"black",children:"Жолооч хүлээн авсан"}):(null==e?void 0:e.status)==4?(0,a.jsx)(v.C,{color:"green",children:"Дууссан"}):(null==e?void 0:e.status)==12?(0,a.jsx)(v.C,{color:"red",children:"Цуцалсан"}):"buruu status"}),(0,a.jsx)(u.i.Td,{children:null==e?void 0:e.region}),(0,a.jsx)(u.i.Td,{children:"".concat((0,y.uf)((null==e?void 0:e.quantity)||"-"))}),(null==Z?void 0:Z.role)==="admin"&&(0,a.jsx)(u.i.Td,{className:"flex justify-center items-center space-x-2 sticky right-0 bg-white",children:(0,a.jsx)(m.A,{color:"yellow",onClick:()=>X.push("/order/".concat(null==e?void 0:e.id)),children:(0,a.jsx)(o.u,{label:"Дэлгэрэнгүй харах",children:(0,a.jsx)(p.Z,{})})})})]},"orderData-".concat(l))):(0,a.jsx)(u.i.Tr,{children:(0,a.jsx)(u.i.Td,{colSpan:12,className:"text-center",children:"Мэдээлэл олдсонгүй"})})})]})}),(0,a.jsx)("div",{className:"border-b border-[#6A5ADF] w-full my-1"}),(0,a.jsxs)("div",{className:"flex justify-between items-center my-1",children:[(0,a.jsxs)("p",{className:"text-sm text-[#6A5ADF]",children:["Нийт ",null==P?void 0:P.length," мөр сонгосон байна"]}),(0,a.jsxs)("p",{className:"flex items-center text-sm text-[#6A5ADF]",children:["Нэг хуудсанд харуулах мөрийн тоо",(0,a.jsxs)("select",{className:"w-12 rounded-md ml-2 pl-0.5 h-6 border border-[#6A5ADF]",onChange:e=>{R(e.target.value),B(0),I(0)},children:[(0,a.jsx)("option",{value:"100",children:"100"}),(0,a.jsx)("option",{value:"250",children:"250"}),(0,a.jsx)("option",{value:"500",children:"500"}),(0,a.jsx)("option",{value:"1000",children:"1000"})]})]})]}),(0,a.jsx)("div",{className:"flex mt-4 items-center justify-end",children:(0,a.jsx)(x.t,{value:U+1,siblings:2,total:Math.floor(((null==en?void 0:en.pagination)||(null==ec?void 0:ec.pagination))/L)+(((null==en?void 0:en.pagination)||(null==ec?void 0:ec.pagination))%L==0?0:1),onChange:e=>{B(e-1),I(e*L-L)},color:"#6A5ADF"})})]}),(0,a.jsx)(D.Z,{opened:Q,onClose:()=>E(!1),select:P,setSelect:H,table:"orders",refetch:eo||eh,data:[{label:"Бараа авч дууссан",value:"4"}]})]})})}}}]);